# Get averages of sensor data
[{"id":"2ad773d5.31ee7c","type":"mqtt in","z":"d404d6b5.5c436","name":"","topic":"test/#","qos":"2","datatype":"json","broker":"b700a1d5.e877","x":230,"y":200,"wires":[["37b1b765.f7c4e"]]},{"id":"37b1b765.f7c4e","type":"join","z":"d404d6b5.5c436","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"2","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":370,"y":200,"wires":[["d8e10d1f.8c6da"]]},{"id":"d8e10d1f.8c6da","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"payload.averageTemperature","pt":"msg","to":"$average(msg.payload.*.temperature)","tot":"jsonata"},{"t":"set","p":"payload.averageCo2","pt":"msg","to":"$average(msg.payload.*.co2)","tot":"jsonata"},{"t":"set","p":"payload.averageHumidity","pt":"msg","to":"$average(msg.payload.*.humidity)","tot":"jsonata"},{"t":"set","p":"payload.averageBattery","pt":"msg","to":"$average(msg.payload.*.battery)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":200,"wires":[[]]},{"id":"57f963d6.d7629c","type":"comment","z":"d404d6b5.5c436","name":"average sensor values","info":"","x":270,"y":140,"wires":[]},{"id":"b700a1d5.e877","type":"mqtt-broker","name":"","broker":"test.ka9n.dk","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""}]

# EiSE setpoint calculation
[{"id":"a5be6010.ab9cf8","type":"comment","z":"d404d6b5.5c436","name":"EiSE","info":"","x":210,"y":340,"wires":[]},{"id":"48de48ae.3f5a48","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"(($millis() ~> $fromMillis('[H]') ~> $number()) >= 4 ? \t    ($millis() ~> $fromMillis('[H]') ~> $number()) \t: \t    ($millis() ~> $fromMillis('[H]') ~> $number()) + 23) \t\t+ (($millis() ~> $fromMillis('[m]') ~> $number())/60) \t- 4","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":400,"wires":[["ab9e2474.43bed"]]},{"id":"daedbbea.a3752","type":"inject","z":"d404d6b5.5c436","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":400,"wires":[["48de48ae.3f5a48"]]},{"id":"ab9e2474.43bed","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload >= 14 ?\t(10-(payload - 14))/10\t:\tpayload/14","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":400,"wires":[["5794e7a5.0a608","5a59e319.10ebd4","1cc705f4.c2d1f2","9df546c5.60a328","44688a2a.27995c","a32a9f8.4d5b7e"]]},{"id":"5794e7a5.0a608","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"23","maxout":"25","action":"scale","round":false,"property":"payload","name":"","x":900,"y":280,"wires":[["51ae3b7c.e5cc54"]]},{"id":"5a59e319.10ebd4","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"21","maxout":"19","action":"scale","round":false,"property":"payload","name":"","x":900,"y":320,"wires":[["74d3db30.b4916c"]]},{"id":"8895a30f.fe778","type":"join","z":"d404d6b5.5c436","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"2","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1250,"y":300,"wires":[[]]},{"id":"51ae3b7c.e5cc54","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Cooling","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":280,"wires":[["8895a30f.fe778"]]},{"id":"74d3db30.b4916c","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Heating","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":320,"wires":[["8895a30f.fe778"]]},{"id":"1cc705f4.c2d1f2","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"23","maxout":"25","action":"scale","round":false,"property":"payload","name":"","x":900,"y":380,"wires":[["8d12df33.28b108"]]},{"id":"9df546c5.60a328","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"19","maxout":"18","action":"scale","round":false,"property":"payload","name":"","x":900,"y":420,"wires":[["e1ff907c.4ecfc8"]]},{"id":"8aebf042.457048","type":"join","z":"d404d6b5.5c436","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"2","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1250,"y":400,"wires":[[]]},{"id":"8d12df33.28b108","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Cooling","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":380,"wires":[["8aebf042.457048"]]},{"id":"e1ff907c.4ecfc8","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Heating","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":420,"wires":[["8aebf042.457048"]]},{"id":"5a7f59cb.1ad2c8","type":"comment","z":"d404d6b5.5c436","name":"Office","info":"","x":1390,"y":300,"wires":[]},{"id":"ebfad8b7.c46a3","type":"comment","z":"d404d6b5.5c436","name":"Institution","info":"","x":1400,"y":400,"wires":[]},{"id":"b073470d.910a7","type":"comment","z":"d404d6b5.5c436","name":"Nursing","info":"","x":1390,"y":500,"wires":[]},{"id":"44688a2a.27995c","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"24","maxout":"26","action":"scale","round":false,"property":"payload","name":"","x":900,"y":480,"wires":[["accbebee.01c2"]]},{"id":"a32a9f8.4d5b7e","type":"range","z":"d404d6b5.5c436","minin":"0","maxin":"1","minout":"23","maxout":"22","action":"scale","round":false,"property":"payload","name":"","x":900,"y":520,"wires":[["1eea30b5.ed009f"]]},{"id":"ba54041f.633868","type":"join","z":"d404d6b5.5c436","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"2","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1250,"y":500,"wires":[[]]},{"id":"accbebee.01c2","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Cooling","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":480,"wires":[["ba54041f.633868"]]},{"id":"1eea30b5.ed009f","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Heating","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":520,"wires":[["ba54041f.633868"]]}]

# Holidays
[{"id":"c3ef593a.39d62","type":"require","z":"d404d6b5.5c436","name":"","module":"date-holidays","field":"payload","fieldType":"msg","x":470,"y":700,"wires":[["46ee649d.8416cc"]]},{"id":"66f6c86c.7e8868","type":"function","z":"d404d6b5.5c436","name":"","func":"var hd = new msg.payload.req(\"DK\")\nvar date = new Date(msg.payload.time*1000)\nvar year = date.getYear() -100 +2000\nvar month = date.getMonth() + 1\nvar today = year+\"-\"+month+\"-\"+ date.getDate()\n\nvar hellig = hd.isHoliday(new Date( today+ ' 00:00:00 GMT+0000'))\nif(!hellig){\n    hellig = {\n        \"name\": \"hverdag\",\n        \"type\": \"workday\"\n    }\n}\n\nmsg.payload = hellig\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":760,"wires":[["33e46f52.a57de"]]},{"id":"64083530.89bbdc","type":"comment","z":"d404d6b5.5c436","name":"Helligdage","info":"","x":220,"y":700,"wires":[]},{"id":"573aafe8.adf13","type":"inject","z":"d404d6b5.5c436","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"time","payload":"","payloadType":"date","x":260,"y":760,"wires":[["c3ef593a.39d62","2bb8a74.8d285d8"]]},{"id":"2bb8a74.8d285d8","type":"join","z":"d404d6b5.5c436","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"1","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":850,"y":760,"wires":[["66f6c86c.7e8868"]]},{"id":"46ee649d.8416cc","type":"change","z":"d404d6b5.5c436","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"req","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":700,"wires":[["2bb8a74.8d285d8"]]},{"id":"33e46f52.a57de","type":"switch","z":"d404d6b5.5c436","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"public","vt":"str"},{"t":"eq","v":"bank","vt":"str"},{"t":"eq","v":"school","vt":"str"},{"t":"eq","v":"optional","vt":"str"},{"t":"eq","v":"observance","vt":"str"},{"t":"eq","v":"workday","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":1190,"y":760,"wires":[[],[],[],[],[],[]]}]

# Heating Circuit 
[{"id":"2e403992682b1068","type":"tab","label":"HeatingCircuit","disabled":false,"info":"","env":[]},{"id":"caaec272859944e1","type":"change","z":"2e403992682b1068","name":"ProcessValue","rules":[{"t":"move","p":"payload[1]","pt":"msg","to":"abc.processValue","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"move","p":"abc.processValue","pt":"msg","to":"payload.processValue","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":660,"wires":[["2e17866f13810dad"]]},{"id":"b38dfdf721280ac9","type":"change","z":"2e403992682b1068","name":"Setpoint","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.setpoint","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":720,"wires":[["2e17866f13810dad"]]},{"id":"d1982510e1b4af21","type":"change","z":"2e403992682b1068","name":"minPV","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.minPV","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":780,"wires":[["2e17866f13810dad"]]},{"id":"0bc518ee6f4e8730","type":"change","z":"2e403992682b1068","name":"maxPV","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.maxPV","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":840,"wires":[["2e17866f13810dad"]]},{"id":"cd6220b42872b360","type":"comment","z":"2e403992682b1068","name":"TemperatureRegulation","info":"","x":840,"y":700,"wires":[]},{"id":"0e25c360d1eadcd8","type":"change","z":"2e403992682b1068","name":"","rules":[{"t":"move","p":"payload.output","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":760,"wires":[["4e77716c63e48744"]]},{"id":"2e17866f13810dad","type":"function","z":"2e403992682b1068","name":"Bang-Hillman Loop Controller","func":"/*+ ------------ Load message ------------ +*/\n    var input = msg.payload;\n\n\n\n/*+ ------------ Set contexts ------------ +*/\n    // value of process controlled by output\n    if (input.hasOwnProperty('processValue')) {\n        context.processValue = Number(input.processValue);\n    }\n\n    // setpoint of processValue controlled by output\n    if (input.hasOwnProperty('setpoint')) {\n        context.setpoint = Number(input.setpoint);\n    } \n\n    // processValue expected when controlValue is 100%\n    if (input.hasOwnProperty('maxPV')) {\n        context.maxPV = Number(input.maxPV);\n    }\n\n    // processValue expected when controlValue is 0%\n    if (input.hasOwnProperty('minPV')) {\n        context.minPV = Number(input.minPV);\n    }\n\n    // Enable property. If false, output will allways be 0% and no calculations are done\n    if (input.hasOwnProperty('enable')) {\n        context.enable = Boolean(input.enable);\n    }\n\n    // save sequencing parameters\n    if (input.hasOwnProperty('sequencing')) {\n        if (input.sequencing.hasOwnProperty('minDirect')) {\n            context.minDirect = input.sequencing.minDirect;\n        }\n        if (input.sequencinghasOwnProperty('minIndirect')) {\n            context.minIndirect = input.sequencingminIndirect;\n        }\n        if (input.sequencinghasOwnProperty('maxDirect')) {\n            context.maxDirect = input.sequencingmaxDirect;\n        }\n        if (input.sequencinghasOwnProperty('maxIndirect')) {\n            context.maxIndirect = input.sequencingmaxIndirect;\n        }\n    }\n    \n\n\n\n/*+ ------------ output guess and PV Model Position ------------ +*/\n    // consider a graph, where the Y-axis is the processVariable and the X-axis is the loop output(0-100%). This is our \"model\"\n    // the output guess is the distance on the X-axis, from 0 to the setpoint in the model\n    // the PV Model Position, is the distance on the X-axis, from 0 to the process value in the model   \n        // Find direction of the loop\n        var direction = \"indirect\";\n       \n        if (context.maxPV < context.minPV ) {\n            var min = context.minPV;\n            var max = context.maxPV;\n            context.minPV = max;\n            context.maxPV = min;\n            direction = \"direct\";\n        }\n\n        // calculate area of operation\n        var areaOfOperation = context.maxPV - context.minPV;\n\n        // default\n        var outputGuess = 0;\n        var pvModelPosition = 0;\n\n        // linear process characteristic\n        if (context.characteristic == 1){\n            outputGuess = ((context.setpoint - context.minPV) * 100.00) / areaOfOperation;\n            pvModelPosition = ((context.processValue - context.minPV) * 100.00) / areaOfOperation;\n        }\n\n        // exponential process characteristic\n        if (context.characteristic == 2) {\n            // calculate curve parameters\n            var b = ((areaOfOperation + 1)) ** (1 / 100);\n            outputGuess = Math.log((context.setpoint - context.minPV +1)) / Math.log(b);\n            pvModelPosition = Math.log((context.processValue - context.minPV +1)) / Math.log(b);\n            // sanitise\n            if( isNaN(outputGuess) ){ outputGuess = 0 }\n            if (isNaN(pvModelPosition)) { pvModelPosition = 0 }\n        }\n\n        // calulate the deviation of the process value from the setpoint\n        var setpointDeviation = 0;\n        if (direction == \"direct\") {\n            setpointDeviation = pvModelPosition - outputGuess;\n        } else {\n            setpointDeviation = outputGuess - pvModelPosition;\n        }\n\n\n/*+ ------------ Initiation ------------ +*/\n    // When the loop is enabled, we must wait the entire Time Constant time, before reacting to the change in Process value\n    var time = Date.now();\n    var timeSinceLast = (time - context.lastTime) / 1000;\n\n    // store the time of loop enable\n    if (context.enable && !context.lastEnable ) {\n        context.enableTime = time;\n        context.startup = true;\n        // make sure to reset any timeconstant calculations\n        context.flag1 = false;\n        context.flag2 = false;\n    }\n\n    // create a variable for the output\n    var output = 0;\n    \n    // if the loop is enabled, set the output\n    if( context.enable ) {\n        if ((time - context.enableTime) / 1000 > context.timeConstant) {\n            react();\n            context.startup = false;\n        } else {\n            // if the process value passes the setpoint, by more than 10 %p, we must react.\n            if (pvModelPosition > outputGuess + 10 && direction == \"indirect\"){\n                react();\n            } else if (pvModelPosition < outputGuess - 10 && direction == \"direct\") {\n                react();\n            } else {\n                output = outputGuess;\n            }\n        }\n    } else {\n        node.status({ fill: \"yellow\", shape: \"dot\", text: \"disabled\" });\n        context.startup = false;\n    }\n    \n\n/*+ ------------ calculate Time Constant ------------ +*/\n    // The Time Constant is ideally the time it takes for the Process Value to stabilize after a change in the output.\n    // In order to automate the loop, we guesstimate the Time Constant, from the deviation from the setpoint over time.\n    if(context.enable) {\n        if (!context.startup) {\n            if (Math.abs(setpointDeviation) > areaOfOperation * 0.1) {\n                if (!context.flag1){\n                    context.deviationTime1 = time;\n                }\n                context.flag1 = true;\n                context.flag2 = false;\n            } \n            // We need a bit of hysteresis, to avoid faulty calculations from unstable Process Values\n            if (Math.abs(setpointDeviation) < areaOfOperation * 0.05) {\n                if(!context.flag2 && context.flag1) {\n                    context.deviationTime2 = time;\n                    var deviationtime = (context.deviationTime2 - context.deviationTime1) / 1000;\n                    // if the deviationtime is more than out our current Time Constant, the loop should be faster\n                    if (deviationtime > context.timeConstant) {\n                        context.timeConstant = context.timeConstant + ((context.timeConstant - deviationtime) * 0.5); \n                    }\n                    // if the deviationtime is less than out our current Time Constant, the loop should be slower\n                    // we make the loop more slow than fast, this is to avoid overcompensation. \n                    // This helps to make the loop more likely to raise the time constant and thereby make the loop more stable\n                    if (deviationtime < context.timeConstant) {\n                        context.timeConstant = context.timeConstant + ((context.timeConstant - deviationtime) * 1 )  ;\n                    }\n\n                }\n                context.flag2 = true;\n                context.flag1 = false;\n            }\n        }\n    }\n    \n\n\n/*+ ------------ react to Process Value  ------------ +*/\n    // when the loop is en \"normal\" operation, we need to react to changes in the Process Value and compensate for\n    // deviations from the setpoint \n    function react(){\n        // how much more should we compensate?\n        var moreCompensation = (setpointDeviation / (context.timeConstant / timeSinceLast));\n        // add to previous compensation\n        context.compensation = context.compensation + moreCompensation;\n\n        // sanitise to never compensate output beyond 0-100\n        if (outputGuess + context.compensation > 100) { context.compensation = 100 - outputGuess}\n        if (outputGuess + context.compensation < 0) { context.compensation = 0 - outputGuess }\n\n        context.startup = false;\n    }\n\n\n/*+ ------------ save parameters for next execution ------------ +*/\n    // we'll need these later\n    context.lastTime = Date.now();\n    context.lastEnable = context.enable;\n\n/*+ ------------ calulate output ------------ +*/\n    output = outputGuess + context.compensation;\n    // sanitise (just to be sure)\n    if (output > 100) { output = 100}\n    if (output < 0) { output = 0 }\n\n    if (direction == \"direct\") {\n        output = 100 - output;\n    }\n\n    // from sequence\n    if (direction == \"direct\"){\n        if (context.minDirect) {output = 0}\n        if (context.maxDirect) { output = 100 }\n    }\n    if (direction == \"indirect\") {\n        if (context.minIndirect) { output = 0 }\n        if (context.maxIndirect) { output = 100 }\n    }\n\n    // from state\n    if (!context.enable) {\n        output = 0;\n    } else {\n        node.status({ fill: \"green\", shape: \"dot\", text: \"active: \" + output });\n    }\n\n\n\n/*+ ------------ sequencing  ------------ +*/\n    // to make it easy to link multiple loops together in a sequence, \n    // we provide msg.sequenceing parameters for next loops and previous loops on different outputs:\n        // sequencing.minDirect - force direct loop to 0%\n        // sequencing.minIndirect - force indirect loop to 0%\n        // sequencing.maxDirect - force direct loop to 100%\n        // sequencing.maxIndirect - force direct loop to 100%\n\n    var sequenceNext;\n    var sequencePrev;\n    \n    // when the loop is active, next loops should be 0% and previous loops of same direction should be 100% \n    if(output != 0) {\n        sequenceNext = {\n            minDirect: true,\n            minIndirect: true,\n            maxDirect: false,\n            maxIndirect: false\n        };\n\n        if (direction == \"direct\"){\n            sequencePrev = {\n                maxDirect: true,\n                minDirect: false,\n            };\n        }\n        if (direction == \"indirect\") {\n            sequencePrev = {\n                maxIndirect: true,\n                minIndirect: false,\n            };\n        }\n    }\n    // when the loop is inactive, next loops of same direction should be 0% and previous loops of same direction should be free to regulate\n    if (output == 0) {\n        if (direction == \"direct\") {\n            sequencePrev = {\n                maxDirect: false,\n                minDirect: false,\n            };\n            sequenceNext = {\n                minDirect: true,\n                maxDirect: false,\n            };\n\n        }\n        if (direction == \"indirect\") {\n            sequencePrev = {\n                maxIndirect: false,\n                minIndirect: false,\n            };\n            sequenceNext = {\n                maxIndirect: false,\n                minIndirect: true,\n            };\n        }\n    }\n    // when the loop is fully regulated, next loops of same direction should be free to regulate and previous loops of same direction should be 100%\n    if (output == 100) {\n        if (direction == \"direct\") {\n            sequencePrev = {\n                maxDirect: true,\n                minDirect: false,\n            };\n            sequenceNext = {\n                minDirect: false,\n                maxDirect: false,\n            };\n\n        }\n        if (direction == \"indirect\") {\n            sequencePrev = {\n                maxIndirect: true,\n                minIndirect: false,\n            };\n            sequenceNext = {\n                maxIndirect: false,\n                minIndirect: false,\n            };\n        }\n    }\n\n\n\n/*+ ------------ send messages ------------ +*/\n    var msg1 = { \n            payload: {\n                \"output\": output,\n                \"processValue\": context.processValue,\n                \"setpoint\": context.setpoint,\n                \"enable\": context.enable\n            }\n        };\n    \n    var msg2 = {\n            payload:{\n                sequencing: sequenceNext\n            }\n        };\n    var msg3 = {\n            payload: {\n                sequencing: sequencePrev\n            }\n    };\n    \n    node.send([msg1, msg2, msg3]);","outputs":3,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\n\n// Set context to make sure the loop is at ready-state\ncontext.enable = false;\ncontext.lastTime = Date.now();\ncontext.lastEnable = false;\ncontext.enableTime = 0;\ncontext.compensation = 0;\ncontext.timeConstant = 10; // seconds\ncontext.deviationTime1 = Date.now();\ncontext.deviationTime2 = Date.now();\ncontext.minDirect = false;\ncontext.minIndirect = false;\ncontext.maxDirect = false;\ncontext.maxIndirect = false;\ncontext.processValue = 0;\ncontext.setpoint = 0;\n\n// Process characteristic, 1 = linear, 2 = exponential\n// consider a graph, where the Y-axis is the processVariable and the X-axis is the loop output (0-100%).\n// how does the curve look, in a perfect world?\ncontext.characteristic = 1;","finalize":"","libs":[],"x":870,"y":760,"wires":[["0e25c360d1eadcd8"],[],[]],"outputLabels":["Regulation","Sequenceing of next loop","Sequenceing of previous loop"],"icon":"font-awesome/fa-wheelchair"},{"id":"4e77716c63e48744","type":"link out","z":"2e403992682b1068","name":"Valve","mode":"link","links":["386af96cdfa1c68c","8a8f0334f63bea1f"],"x":1450,"y":760,"wires":[],"l":true},{"id":"66f1ad91aca94969","type":"link out","z":"2e403992682b1068","name":"Pump","mode":"link","links":[],"x":1450,"y":820,"wires":[],"l":true},{"id":"842fb00fd1b918cf","type":"link out","z":"2e403992682b1068","name":"TemperatureSupplySecondary","mode":"link","links":[],"x":1230,"y":240,"wires":[],"l":true},{"id":"f2ab518340045842","type":"link out","z":"2e403992682b1068","name":"TemperatureSupplyPrimary","mode":"link","links":["141ac2b630b3e4db"],"x":1220,"y":300,"wires":[],"l":true},{"id":"b8ae60671491a601","type":"link out","z":"2e403992682b1068","name":"TemperatureReturnPrimary","mode":"link","links":["53e2689535922a73","0e39cf8aee062ba8"],"x":1220,"y":360,"wires":[],"l":true},{"id":"e4cccb08d3dcb4a1","type":"link out","z":"2e403992682b1068","name":"SetpointTemperatureSupplySecondary","mode":"link","links":["d022ecd4e688524d"],"x":1250,"y":480,"wires":[],"l":true},{"id":"2c2844f325973b17","type":"link in","z":"2e403992682b1068","name":"link in 2","links":["621aa61e58b13a0f"],"x":345,"y":660,"wires":[["caaec272859944e1"]]},{"id":"53e2689535922a73","type":"link in","z":"2e403992682b1068","name":"link in 3","links":["b8ae60671491a601"],"x":345,"y":780,"wires":[["d1982510e1b4af21"]]},{"id":"0e39cf8aee062ba8","type":"link in","z":"2e403992682b1068","name":"link in 4","links":["b8ae60671491a601"],"x":345,"y":900,"wires":[["844ff284274918ac"]]},{"id":"d022ecd4e688524d","type":"link in","z":"2e403992682b1068","name":"link in 6","links":["e4cccb08d3dcb4a1"],"x":345,"y":720,"wires":[["b38dfdf721280ac9"]]},{"id":"389ade6012fe4a70","type":"inject","z":"2e403992682b1068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"70","payloadType":"num","x":970,"y":300,"wires":[["f2ab518340045842"]]},{"id":"bf22e8ae5deb8e1b","type":"inject","z":"2e403992682b1068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"30","payloadType":"num","x":970,"y":360,"wires":[["b8ae60671491a601"]]},{"id":"542d58a3bbf18a14","type":"link out","z":"2e403992682b1068","name":"SetpointTemperatureReturnSecondary","mode":"link","links":["72628ec868fddbc1"],"x":1250,"y":420,"wires":[],"l":true},{"id":"72628ec868fddbc1","type":"link in","z":"2e403992682b1068","name":"link in 5","links":["542d58a3bbf18a14"],"x":1465,"y":420,"wires":[["3bcd2b9991148dd5"]]},{"id":"3bcd2b9991148dd5","type":"change","z":"2e403992682b1068","name":"","rules":[{"t":"set","p":"returnSetpoint","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":420,"wires":[[]]},{"id":"844ff284274918ac","type":"function","z":"2e403992682b1068","name":"Hysteresis","func":"var msg = msg.payload ;\nif ( msg > flow.get(\"returnSetpoint\") + 2 ) {\n    context.enable = false;\n}\nif (msg < flow.get(\"returnSetpoint\") - 2) {\n    context.enable = true;\n}\n\n\n\nmsg = {\n    payload: {\n        enable: context.enable\n    }    \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\n\ncontext.enable = false ;","finalize":"","libs":[],"x":490,"y":900,"wires":[["2e17866f13810dad","1a763c7d7b95f75f"]]},{"id":"1a763c7d7b95f75f","type":"change","z":"2e403992682b1068","name":"","rules":[{"t":"move","p":"payload.enable","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":820,"wires":[["66f1ad91aca94969"]]},{"id":"5fcb6d46dc9a7e59","type":"inject","z":"2e403992682b1068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"70","payloadType":"num","x":970,"y":420,"wires":[["542d58a3bbf18a14"]]},{"id":"7a0de34bc4d2e95d","type":"inject","z":"2e403992682b1068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"30","payloadType":"num","x":970,"y":480,"wires":[["e4cccb08d3dcb4a1"]]},{"id":"64e84303be5ae7cc","type":"inject","z":"2e403992682b1068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":970,"y":240,"wires":[["842fb00fd1b918cf"]]},{"id":"141ac2b630b3e4db","type":"link in","z":"2e403992682b1068","name":"link in 8","links":["f2ab518340045842"],"x":345,"y":840,"wires":[["0bc518ee6f4e8730"]]}]

# ISMA modbus
[{"id":"cdc9bf9e74e4d0ae","type":"tab","label":"ISMA MIX","disabled":false,"info":"","env":[{"name":"address","value":"5","type":"num"}]},{"id":"7c81d8054ce97da9","type":"modbus-flex-getter","z":"cdc9bf9e74e4d0ae","name":"","showStatusActivities":false,"showErrors":true,"showWarnings":true,"logIOActivities":false,"server":"bf4c3854647454d5","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":710,"y":380,"wires":[["ec25dd625098e3a8"],[]]},{"id":"304cc6664fcf54e5","type":"function","z":"cdc9bf9e74e4d0ae","name":"DI","func":"msg.payload = { \n    'fc': 3, \n    'unitid': flow.get(\"address\"), \n    'address': 15 , \n    'quantity': 1\n    }\nmsg.topic = \"DI\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":380,"wires":[["7c81d8054ce97da9"]]},{"id":"87e71a91aa514339","type":"inject","z":"cdc9bf9e74e4d0ae","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":380,"wires":[["304cc6664fcf54e5","e4a4691ab9f489ea","03013231d1ac2f28","ab571cabd6d07b06"]]},{"id":"27fea3403deb3c70","type":"modbus-flex-write","z":"cdc9bf9e74e4d0ae","name":"","showStatusActivities":false,"showErrors":false,"showWarnings":true,"server":"bf4c3854647454d5","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":1050,"y":1020,"wires":[[],[]]},{"id":"b23e8fe410b25b90","type":"change","z":"cdc9bf9e74e4d0ae","name":"","rules":[{"t":"set","p":"address","pt":"flow","to":"address","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":180,"wires":[[]]},{"id":"8d412268b2b325be","type":"inject","z":"cdc9bf9e74e4d0ae","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":180,"wires":[["b23e8fe410b25b90"]]},{"id":"a8b1f91166b4771e","type":"function","z":"cdc9bf9e74e4d0ae","name":"DI status","func":"var number = msg.payload[0];\n\nfunction isOn(n,k) {\n    return (n & (1 << k)) > 0;\n}\n\nvar digitalInputs = [\"not used\"];\n\nfor (let i = 0; i < 12; i++) {\n    \n    digitalInputs.push(isOn(number, i));\n}\n\nflow.set(\"digitalInputs\", digitalInputs);\n\nmsg.payload = digitalInputs;\nmsg.topic = \"digitalInputs\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":300,"wires":[["c1a4b02b9965e5e4"]]},{"id":"ec25dd625098e3a8","type":"switch","z":"cdc9bf9e74e4d0ae","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"DI","vt":"str"},{"t":"eq","v":"DIcount","vt":"str"},{"t":"eq","v":"UIvoltage","vt":"str"},{"t":"eq","v":"UItemp","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":950,"y":380,"wires":[["a8b1f91166b4771e"],["f6d41876f6753688"],["172cb52a620ae6e9"],["b0716adf5a20b1dd"]]},{"id":"e4a4691ab9f489ea","type":"function","z":"cdc9bf9e74e4d0ae","name":"DI count","func":"msg.payload = { \n    'fc': 4, \n    'unitid': flow.get(\"address\"), \n    'address': 22, \n    'quantity': 24\n    }\nmsg.topic = \"DIcount\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":420,"wires":[["7c81d8054ce97da9"]]},{"id":"f6d41876f6753688","type":"function","z":"cdc9bf9e74e4d0ae","name":"DI counts","func":"var number = msg.payload;\nvar buffer = new ArrayBuffer(4);\nvar view = new DataView(buffer);\n\nfunction make32(h,l) {\n    view.setInt16(0, number[h], false);\n    view.setInt16(2, number[l], false);\n    return view.getInt32(0, false);\n}\n\nvar digitalInputCounts = [\"not used\"];\n\nfor (let i = 0; i < 24; i+=2) {\n    digitalInputCounts.push(make32(i+1,i));\n}\n\nflow.set(\"digitalInputCounts\", digitalInputCounts);\n\nmsg.payload = digitalInputCounts;\nmsg.topic = \"digitalInputCounts\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":340,"wires":[["8716b458c1ec998d"]]},{"id":"03013231d1ac2f28","type":"function","z":"cdc9bf9e74e4d0ae","name":"UI Volt","func":"msg.payload = { \n    'fc': 3, \n    'unitid': flow.get(\"address\"), \n    'address': 86, \n    'quantity': 8\n    }\nmsg.topic = \"UIvoltage\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":460,"wires":[["7c81d8054ce97da9"]]},{"id":"ab571cabd6d07b06","type":"function","z":"cdc9bf9e74e4d0ae","name":"UItemp","func":"msg.payload = { \n    'fc': 3, \n    'unitid': flow.get(\"address\"), \n    'address': 94, \n    'quantity': 8\n    }\nmsg.topic = \"UItemp\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":500,"wires":[["7c81d8054ce97da9"]]},{"id":"a7469d16f9a8bfc9","type":"function","z":"cdc9bf9e74e4d0ae","name":"UI settings","func":"/* TYPES\n0 Resistanc measurement off\n1 10K3A1 NTC\n2 10K4A1 NTC\n3 10K NTC Carel\n4 20K6A1 NTC\n5 2,2K3A1 NTC B=3975K\n6 3K3A1 NTC\n7 30K6A1 NTC\n8 SIE1\n9 TAC1\n10 SAT1\n16 Pt1000\n17 Ni1000\n+128 Voltage measurement off\n*/\n\n// types, see above\nvar UI1type = 1;\nvar UI2type = 1;\nvar UI3type = 1;\nvar UI4type = 1;\nvar UI5type = 1;\nvar UI6type = 1;\nvar UI7type = 1;\nvar UI8type = 1;\n\n// filtertime in seconds\nvar UI1filter = 1;\nvar UI2filter = 1;\nvar UI3filter = 1;\nvar UI4filter = 1;\nvar UI5filter = 1;\nvar UI6filter = 1;\nvar UI7filter = 1;\nvar UI8filter = 1;\n\n\n\n\n\nlet values = [\n    UI1type,\n    UI2type,\n    UI3type,\n    UI4type,\n    UI5type,\n    UI6type,\n    UI7type,\n    UI8type,\n    UI1filter,\n    UI2filter,\n    UI3filter,\n    UI4filter,\n    UI5filter,\n    UI6filter,\n    UI7filter,\n    UI8filter\n];\n\n\nmsg.payload = { \n    'value': values, \n    'fc': 16, \n    'unitid': flow.get(\"address\"), \n    'address': 150 , \n    'quantity': 16\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":640,"wires":[["27fea3403deb3c70"]]},{"id":"b20dd65e53de6349","type":"inject","z":"cdc9bf9e74e4d0ae","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":640,"wires":[["a7469d16f9a8bfc9"]]},{"id":"b0716adf5a20b1dd","type":"function","z":"cdc9bf9e74e4d0ae","name":"UI Temp","func":"var number = msg.payload;\n\nvar temperatures = [\"not used\"];\n\nfor (let i = 0; i < 8; i++) {\n    temperatures.push((Number)(number[i]/10));\n}\n\nflow.set(\"temperatures\", temperatures);\n\nmsg.payload = temperatures;\nmsg.topic = \"temperatures\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":420,"wires":[["86e25eed49c41efb"]]},{"id":"172cb52a620ae6e9","type":"function","z":"cdc9bf9e74e4d0ae","name":"UI Volt","func":"var number = msg.payload;\n\nvar voltage = [\"not used\"];\n\nfor (let i = 0; i < 8; i++) {\n    voltage.push((Number)(number[i]/1000));\n}\n\nflow.set(\"voltage\", voltage);\n\nmsg.payload = voltage;\nmsg.topic = \"voltage\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1170,"y":380,"wires":[["677a95a36c235ca6"]]},{"id":"d9a28ce8f657ac5d","type":"function","z":"cdc9bf9e74e4d0ae","name":"DO","func":"var values = msg.payload;\n\nmsg.payload = { 'value': values, \n    'fc': 6, \n    'unitid': flow.get(\"address\"), \n    'address': 17 , \n    'quantity': 1 \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":700,"wires":[["27fea3403deb3c70"]]},{"id":"3621c69291a2b695","type":"change","z":"cdc9bf9e74e4d0ae","name":"","rules":[{"t":"set","p":"digitalOut","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":240,"wires":[[]]},{"id":"1021c86bbc0ce4bf","type":"inject","z":"cdc9bf9e74e4d0ae","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":240,"wires":[["3621c69291a2b695"]]},{"id":"dbb0efe04ceda3f1","type":"function","z":"cdc9bf9e74e4d0ae","name":"function 1","func":"var x = flow.get(\"digitalOut\")\n\nvar o = [\"O1\", \"O2\", \"O3\", \"O4\", \"O5\", \"O6\", \"O7\", \"O8\", \"O9\", \"O10\", \"O11\", \"O12\"]\n\nfor (let index = 0; index < 12; index++) {\n    if(msg.topic == o[index]) {\n        if(msg.payload == true){\n            x = x | 1 << index\n        }else{\n            x = x &= ~index\n        }\n    }\n}\n\nflow.set(\"digitalOut\", x)\n\n\nmsg.payload = x;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":700,"wires":[["d9a28ce8f657ac5d"]]},{"id":"8ffd770481a58080","type":"change","z":"cdc9bf9e74e4d0ae","name":"O1","rules":[{"t":"set","p":"topic","pt":"msg","to":"O1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":700,"wires":[["dbb0efe04ceda3f1"]]},{"id":"e282e0d8f402c09e","type":"change","z":"cdc9bf9e74e4d0ae","name":"O2","rules":[{"t":"set","p":"topic","pt":"msg","to":"O2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":740,"wires":[["dbb0efe04ceda3f1"]]},{"id":"e25a55c51210c2b1","type":"change","z":"cdc9bf9e74e4d0ae","name":"O3","rules":[{"t":"set","p":"topic","pt":"msg","to":"O3","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":780,"wires":[["dbb0efe04ceda3f1"]]},{"id":"83b8675eee777576","type":"change","z":"cdc9bf9e74e4d0ae","name":"O4","rules":[{"t":"set","p":"topic","pt":"msg","to":"O4","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":820,"wires":[["dbb0efe04ceda3f1"]]},{"id":"9e49da2a2b91b6db","type":"change","z":"cdc9bf9e74e4d0ae","name":"O5","rules":[{"t":"set","p":"topic","pt":"msg","to":"O5","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":860,"wires":[["dbb0efe04ceda3f1"]]},{"id":"3028227d9c8bb5ca","type":"change","z":"cdc9bf9e74e4d0ae","name":"O6","rules":[{"t":"set","p":"topic","pt":"msg","to":"O6","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":900,"wires":[["dbb0efe04ceda3f1"]]},{"id":"0bcd2bbcea410771","type":"change","z":"cdc9bf9e74e4d0ae","name":"O7","rules":[{"t":"set","p":"topic","pt":"msg","to":"O7","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":940,"wires":[["dbb0efe04ceda3f1"]]},{"id":"6435169c35dd676b","type":"change","z":"cdc9bf9e74e4d0ae","name":"O8","rules":[{"t":"set","p":"topic","pt":"msg","to":"O8","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":980,"wires":[["dbb0efe04ceda3f1"]]},{"id":"bf3a709fcb7d15c5","type":"change","z":"cdc9bf9e74e4d0ae","name":"O9","rules":[{"t":"set","p":"topic","pt":"msg","to":"O9","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1020,"wires":[["dbb0efe04ceda3f1"]]},{"id":"e8f4a805fe483b85","type":"change","z":"cdc9bf9e74e4d0ae","name":"O10","rules":[{"t":"set","p":"topic","pt":"msg","to":"O10","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1060,"wires":[["dbb0efe04ceda3f1"]]},{"id":"148d2a415b2a2c0a","type":"change","z":"cdc9bf9e74e4d0ae","name":"O11","rules":[{"t":"set","p":"topic","pt":"msg","to":"O11","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1100,"wires":[["dbb0efe04ceda3f1"]]},{"id":"2aa3fbed6689b3c6","type":"change","z":"cdc9bf9e74e4d0ae","name":"O12","rules":[{"t":"set","p":"topic","pt":"msg","to":"O12","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1140,"wires":[["dbb0efe04ceda3f1"]]},{"id":"7794adf4a38a82c5","type":"comment","z":"cdc9bf9e74e4d0ae","name":"you can set these","info":"","x":680,"y":600,"wires":[]},{"id":"42e471ef1275ae93","type":"function","z":"cdc9bf9e74e4d0ae","name":"A1","func":"msg.payload = { 'value': (Number) (msg.payload*1000), \n    'fc': 6, \n    'unitid': flow.get(\"address\"), \n    'address': 120 , \n    'quantity': 1 \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1280,"wires":[["27fea3403deb3c70"]]},{"id":"6dc474a22e932378","type":"function","z":"cdc9bf9e74e4d0ae","name":"A2","func":"msg.payload = {\n    'value': (Number)(msg.payload * 1000),\n    'fc': 6,\n    'unitid': flow.get(\"address\"),\n    'address': 121,\n    'quantity': 1\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1320,"wires":[["27fea3403deb3c70"]]},{"id":"d5a579381a9f795b","type":"function","z":"cdc9bf9e74e4d0ae","name":"A3","func":"msg.payload = {\n    'value': (Number)(msg.payload * 1000),\n    'fc': 6,\n    'unitid': flow.get(\"address\"),\n    'address': 122,\n    'quantity': 1\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1360,"wires":[["27fea3403deb3c70"]]},{"id":"c520a9a2e3b43746","type":"function","z":"cdc9bf9e74e4d0ae","name":"A4","func":"msg.payload = {\n    'value': (Number)(msg.payload * 1000),\n    'fc': 6,\n    'unitid': flow.get(\"address\"),\n    'address': 123,\n    'quantity': 1\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1400,"wires":[["27fea3403deb3c70"]]},{"id":"6a18227032a56d8e","type":"function","z":"cdc9bf9e74e4d0ae","name":"A5","func":"msg.payload = {\n    'value': (Number)(msg.payload * 1000),\n    'fc': 6,\n    'unitid': flow.get(\"address\"),\n    'address': 124,\n    'quantity': 1\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1440,"wires":[["27fea3403deb3c70"]]},{"id":"f6d0881208e858b7","type":"function","z":"cdc9bf9e74e4d0ae","name":"A6","func":"msg.payload = {\n    'value': (Number)(msg.payload * 1000),\n    'fc': 6,\n    'unitid': flow.get(\"address\"),\n    'address': 125,\n    'quantity': 1\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":1480,"wires":[["27fea3403deb3c70"]]},{"id":"c1a4b02b9965e5e4","type":"link out","z":"cdc9bf9e74e4d0ae","name":"DI","mode":"link","links":[],"x":1365,"y":300,"wires":[]},{"id":"8716b458c1ec998d","type":"link out","z":"cdc9bf9e74e4d0ae","name":"DI count","mode":"link","links":[],"x":1365,"y":340,"wires":[]},{"id":"677a95a36c235ca6","type":"link out","z":"cdc9bf9e74e4d0ae","name":"UI voltage","mode":"link","links":[],"x":1365,"y":380,"wires":[]},{"id":"86e25eed49c41efb","type":"link out","z":"cdc9bf9e74e4d0ae","name":"UI temperature","mode":"link","links":[],"x":1365,"y":420,"wires":[]},{"id":"9ee7eb32def02a00","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O1","links":[],"x":195,"y":700,"wires":[["8ffd770481a58080"]]},{"id":"1f79d1c2e1a7b554","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O2","links":[],"x":195,"y":740,"wires":[["e282e0d8f402c09e"]]},{"id":"e50c1e4e3e0bcb05","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O3","links":[],"x":195,"y":780,"wires":[["e25a55c51210c2b1"]]},{"id":"c24a5a0cd64a2a97","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O4","links":[],"x":195,"y":820,"wires":[["83b8675eee777576"]]},{"id":"4abae53779233a1b","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O5","links":[],"x":195,"y":860,"wires":[["9e49da2a2b91b6db"]]},{"id":"9bf77946528fcf91","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O6","links":[],"x":195,"y":900,"wires":[["3028227d9c8bb5ca"]]},{"id":"a1ef51c3bc7e09f0","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O7","links":[],"x":195,"y":940,"wires":[["0bcd2bbcea410771"]]},{"id":"e812fd02e8eeb338","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O8","links":[],"x":195,"y":980,"wires":[["6435169c35dd676b"]]},{"id":"16d05b6b4a075906","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O9","links":[],"x":195,"y":1020,"wires":[["bf3a709fcb7d15c5"]]},{"id":"a728cc53f7944b50","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O10","links":[],"x":195,"y":1060,"wires":[["e8f4a805fe483b85"]]},{"id":"5173d91724c1be1d","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O11","links":[],"x":195,"y":1100,"wires":[["148d2a415b2a2c0a"]]},{"id":"6c3575572189f10f","type":"link in","z":"cdc9bf9e74e4d0ae","name":"O12","links":[],"x":195,"y":1140,"wires":[["2aa3fbed6689b3c6"]]},{"id":"9f315a368e6b0f15","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A1","links":[],"x":355,"y":1280,"wires":[["42e471ef1275ae93"]]},{"id":"220757bcd169cf41","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A2","links":[],"x":355,"y":1320,"wires":[["6dc474a22e932378"]]},{"id":"ce136326e18f191f","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A3","links":[],"x":355,"y":1360,"wires":[["d5a579381a9f795b"]]},{"id":"fb6e5e20213f59ad","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A4","links":[],"x":355,"y":1400,"wires":[["c520a9a2e3b43746"]]},{"id":"f45d010fc9798c45","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A5","links":[],"x":355,"y":1440,"wires":[["6a18227032a56d8e"]]},{"id":"9d10876371c35994","type":"link in","z":"cdc9bf9e74e4d0ae","name":"A6","links":[],"x":355,"y":1480,"wires":[["f6d0881208e858b7"]]},{"id":"bf4c3854647454d5","type":"modbus-client","name":"","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"failureLogEnabled":false,"tcpHost":"10.123.18.17","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","serialAsciiResponseStartDelimiter":"0x3A","unit_id":"5","commandDelay":"1","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":true,"showWarnings":true,"showLogs":true}]

