// Hvidovre / Frydenh√∏jskolen
[{"id":"dfacbc6.89ec44","type":"subflow","name":"AM103 to Modbus","info":"","category":"","in":[{"x":200,"y":140,"wires":[{"id":"6b11aa8f.84981c"},{"id":"ea62832f.011ee8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"7ca5af9a.33634","type":"modbus-flex-write","z":"dfacbc6.89ec44","name":"","showStatusActivities":false,"showErrors":false,"server":"2043f56b.c0f832","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1090,"y":140,"wires":[[],[]]},{"id":"bbd51f72.9a848","type":"split","z":"dfacbc6.89ec44","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"value","x":550,"y":120,"wires":[["69fcab3f.6a0b74"]]},{"id":"6b11aa8f.84981c","type":"change","z":"dfacbc6.89ec44","name":"","rules":[{"t":"set","p":"object.spreadFactor","pt":"msg","to":"dr.spreadFactor","tot":"msg"},{"t":"set","p":"object.snr","pt":"msg","to":"snr","tot":"msg"},{"t":"set","p":"object.rssi","pt":"msg","to":"rssi","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"object","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":120,"wires":[["bbd51f72.9a848"]]},{"id":"69fcab3f.6a0b74","type":"delay","z":"dfacbc6.89ec44","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":120,"wires":[["460cb3ee.16e79c"]]},{"id":"460cb3ee.16e79c","type":"function","z":"dfacbc6.89ec44","name":"AM103+L","func":"var UNIT = env.get(\"UNIT\");\n\nlet address = 0;\n\nif(msg.value == \"battery\") {\n    address = 1;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"co2\") address = 2;\n\nif(msg.value == \"humidity\") {\n    address = 3;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"temperature\") {\n    address = 4;\n    msg.payload = msg.payload*10;\n}\nif(msg.value == \"rssi\") {\n    address = 5;\n    msg.payload = msg.payload*-1;\n}\nif(msg.value == \"snr\") {\n    address = 6;\n    msg.payload = (msg.payload + 100)*10;\n}\nif(msg.payload.value == \"fault\") {\n    address = 7;\n    msg.payload = msg.payload.payload;\n}\nif(msg.value == \"spreadFactor\") {\n    address = 8;\n    msg.payload = msg.payload;\n}\n\n\n\nmsg.payload = { \n    'value': msg.payload, \n    'fc': 6, \n    'unitid': UNIT, \n    'address': address,\n    'quantity': 1\n}\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":140,"wires":[["7ca5af9a.33634"]]},{"id":"bc4f10c8.9bff1","type":"modbus-queue-info","z":"dfacbc6.89ec44","name":"","topic":"","unitid":"${UNIT}","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"2043f56b.c0f832","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":1310,"y":140,"wires":[[]]},{"id":"ea62832f.011ee8","type":"trigger","z":"dfacbc6.89ec44","name":"CommFault","op1":"{\"value\":\"fault\",\"payload\":0}","op2":"{\"value\":\"fault\",\"payload\":1}","op1type":"json","op2type":"json","duration":"5","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":200,"wires":[["460cb3ee.16e79c"]]},{"id":"2043f56b.c0f832","type":"modbus-client","name":"JACE","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"192.168.23.10","tcpPort":"5021","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"","commandDelay":"0","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":false},{"id":"4bb3d76d.b228e8","type":"switch","z":"c1c47cc4.0bfe78","name":"FHS","property":"deveui","propertyType":"msg","rules":[{"t":"eq","v":"24e124725d243072","vt":"str"},{"t":"eq","v":"24e124725d244075","vt":"str"},{"t":"eq","v":"24e124725d221716","vt":"str"},{"t":"eq","v":"24e124725d221014","vt":"str"},{"t":"eq","v":"24e124725d221015","vt":"str"},{"t":"eq","v":"24e124725d243859","vt":"str"},{"t":"eq","v":"24e124725d226595","vt":"str"},{"t":"eq","v":"24e124725d243268","vt":"str"},{"t":"eq","v":"24e124725d242967","vt":"str"},{"t":"eq","v":"24e124725d243341","vt":"str"},{"t":"eq","v":"24e124725d243952","vt":"str"},{"t":"eq","v":"24e124725d243726","vt":"str"},{"t":"eq","v":"24e124725d224999","vt":"str"},{"t":"eq","v":"24e124725d243427","vt":"str"},{"t":"eq","v":"24e124725d224148","vt":"str"},{"t":"eq","v":"24e124725d243045","vt":"str"},{"t":"eq","v":"24e124725d225793","vt":"str"},{"t":"eq","v":"24e124725d243591","vt":"str"},{"t":"eq","v":"24e124725d243666","vt":"str"},{"t":"eq","v":"24e124725d221821","vt":"str"},{"t":"eq","v":"24e124725d242858","vt":"str"},{"t":"eq","v":"24e124725d243281","vt":"str"},{"t":"eq","v":"24e124725d220969","vt":"str"},{"t":"eq","v":"24e124725d240019","vt":"str"},{"t":"eq","v":"24e124725d243629","vt":"str"},{"t":"eq","v":"24e124725d224674","vt":"str"},{"t":"eq","v":"24e124725d243682","vt":"str"},{"t":"eq","v":"24e124725d221879","vt":"str"},{"t":"eq","v":"24e124725d243132","vt":"str"},{"t":"eq","v":"24e124725d243334","vt":"str"},{"t":"eq","v":"24e124725d243587","vt":"str"},{"t":"eq","v":"24e124725d243091","vt":"str"},{"t":"eq","v":"24e124725d243504","vt":"str"},{"t":"eq","v":"24e124725d242939","vt":"str"},{"t":"eq","v":"24e124725d243814","vt":"str"},{"t":"eq","v":"24e124725d243533","vt":"str"},{"t":"eq","v":"24e124725d226420","vt":"str"},{"t":"eq","v":"24e124725d243710","vt":"str"}],"checkall":"true","repair":false,"outputs":38,"x":470,"y":1040,"wires":[["afaa6087.9dbc58"],["b348b2be.2bc698"],["b9eaa5cf.6daa6"],["a0c44495.705b6"],["cd09035a.7d489"],["4e0035af.c8ae34"],["49c10b8d.0d275c"],["c14720ea.cef1d"],["6d23928e.f7fddc"],["1b57b409.b37604"],["e6a629d5.7336c8"],["cf9d2739.6b5b28"],["7d29e243.9124ec"],["102bc31b.7923f5"],["281741fe.a90576"],["46b5be9c.f11d28"],["3b4c03d2.63c464"],["396bf353.c2cd3c"],["e737c0a9.20e478"],["d980750c.908b78"],["bfcfa753.e9c0f"],["5ef0251e.072b54"],["2c5ed13c.43e32e"],["5ff4c5d1.469ccc"],["d8e9536c.d373"],["606b8ae5.706734"],["51b12d54.6a6fe4"],["5f47bb82.7f047c"],["a9d70c3e.f45a68"],["8caf3e22.5ce49"],["c017dcdc.48baf8"],["a533cc1c.8c59b"],["73d31b6f.c09f64"],["dfaf1593.99839"],["3461ca34.44f4c6"],["2c7dd5d5.ab8822"],["d59db537.3c4e6"],["8755698b.ef00b"]]},{"id":"afaa6087.9dbc58","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"1","env":[{"name":"UNIT","value":"1","type":"num"}],"x":770,"y":680,"wires":[]},{"id":"b9eaa5cf.6daa6","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"3","env":[{"name":"UNIT","value":"3","type":"num"}],"x":770,"y":720,"wires":[]},{"id":"cd09035a.7d489","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"5","env":[{"name":"UNIT","value":"5","type":"num"}],"x":770,"y":760,"wires":[]},{"id":"49c10b8d.0d275c","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"7","env":[{"name":"UNIT","value":"7","type":"num"}],"x":770,"y":800,"wires":[]},{"id":"6d23928e.f7fddc","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"9","env":[{"name":"UNIT","value":"9","type":"num"}],"x":770,"y":840,"wires":[]},{"id":"b348b2be.2bc698","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"2","env":[{"name":"UNIT","value":"2","type":"num"}],"x":930,"y":700,"wires":[]},{"id":"a0c44495.705b6","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"4","env":[{"name":"UNIT","value":"4","type":"num"}],"x":930,"y":740,"wires":[]},{"id":"4e0035af.c8ae34","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"6","env":[{"name":"UNIT","value":"6","type":"num"}],"x":930,"y":780,"wires":[]},{"id":"c14720ea.cef1d","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"8","env":[{"name":"UNIT","value":"8","type":"num"}],"x":930,"y":820,"wires":[]},{"id":"1b57b409.b37604","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"10","env":[{"name":"UNIT","value":"10","type":"num"}],"x":930,"y":860,"wires":[]},{"id":"e6a629d5.7336c8","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"11","env":[{"name":"UNIT","value":"11","type":"num"}],"x":770,"y":880,"wires":[]},{"id":"cf9d2739.6b5b28","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"12","env":[{"name":"UNIT","value":"12","type":"num"}],"x":930,"y":900,"wires":[]},{"id":"7d29e243.9124ec","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"13","env":[{"name":"UNIT","value":"13","type":"num"}],"x":770,"y":920,"wires":[]},{"id":"102bc31b.7923f5","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"14","env":[{"name":"UNIT","value":"14","type":"num"}],"x":930,"y":940,"wires":[]},{"id":"281741fe.a90576","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"15","env":[{"name":"UNIT","value":"15","type":"num"}],"x":770,"y":960,"wires":[]},{"id":"46b5be9c.f11d28","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"16","env":[{"name":"UNIT","value":"16","type":"num"}],"x":930,"y":980,"wires":[]},{"id":"3b4c03d2.63c464","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"17","env":[{"name":"UNIT","value":"17","type":"num"}],"x":770,"y":1000,"wires":[]},{"id":"396bf353.c2cd3c","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"18","env":[{"name":"UNIT","value":"18","type":"num"}],"x":930,"y":1020,"wires":[]},{"id":"e737c0a9.20e478","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"19","env":[{"name":"UNIT","value":"19","type":"num"}],"x":770,"y":1040,"wires":[]},{"id":"d980750c.908b78","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"20","env":[{"name":"UNIT","value":"20","type":"num"}],"x":930,"y":1060,"wires":[]},{"id":"bfcfa753.e9c0f","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"21","env":[{"name":"UNIT","value":"21","type":"num"}],"x":770,"y":1080,"wires":[]},{"id":"5ef0251e.072b54","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"22","env":[{"name":"UNIT","value":"22","type":"num"}],"x":930,"y":1100,"wires":[]},{"id":"2c5ed13c.43e32e","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"23","env":[{"name":"UNIT","value":"23","type":"num"}],"x":770,"y":1120,"wires":[]},{"id":"5ff4c5d1.469ccc","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"24","env":[{"name":"UNIT","value":"24","type":"num"}],"x":930,"y":1140,"wires":[]},{"id":"d8e9536c.d373","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"25","env":[{"name":"UNIT","value":"25","type":"num"}],"x":770,"y":1160,"wires":[]},{"id":"606b8ae5.706734","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"26","env":[{"name":"UNIT","value":"26","type":"num"}],"x":930,"y":1180,"wires":[]},{"id":"51b12d54.6a6fe4","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"27","env":[{"name":"UNIT","value":"27","type":"num"}],"x":770,"y":1200,"wires":[]},{"id":"5f47bb82.7f047c","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"28","env":[{"name":"UNIT","value":"28","type":"num"}],"x":930,"y":1220,"wires":[]},{"id":"a9d70c3e.f45a68","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"29","env":[{"name":"UNIT","value":"29","type":"num"}],"x":770,"y":1240,"wires":[]},{"id":"8caf3e22.5ce49","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"30","env":[{"name":"UNIT","value":"30","type":"num"}],"x":930,"y":1260,"wires":[]},{"id":"c017dcdc.48baf8","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"31","env":[{"name":"UNIT","value":"31","type":"num"}],"x":770,"y":1280,"wires":[]},{"id":"a533cc1c.8c59b","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"32","env":[{"name":"UNIT","value":"32","type":"num"}],"x":930,"y":1300,"wires":[]},{"id":"73d31b6f.c09f64","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"33","env":[{"name":"UNIT","value":"33","type":"num"}],"x":770,"y":1320,"wires":[]},{"id":"dfaf1593.99839","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"34","env":[{"name":"UNIT","value":"34","type":"num"}],"x":930,"y":1340,"wires":[]},{"id":"3461ca34.44f4c6","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"35","env":[{"name":"UNIT","value":"35","type":"num"}],"x":770,"y":1360,"wires":[]},{"id":"2c7dd5d5.ab8822","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"36","env":[{"name":"UNIT","value":"36","type":"num"}],"x":930,"y":1380,"wires":[]},{"id":"d59db537.3c4e6","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"37","env":[{"name":"UNIT","value":"37","type":"num"}],"x":770,"y":1400,"wires":[]},{"id":"8755698b.ef00b","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"38","env":[{"name":"UNIT","value":"38","type":"num"}],"x":930,"y":1420,"wires":[]}]
