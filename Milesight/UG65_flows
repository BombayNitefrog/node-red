// LORA to Modbus TCP
[{"id":"dfacbc6.89ec44","type":"subflow","name":"Subflow 2","info":"","in":[{"x":200,"y":140,"wires":[{"id":"6b11aa8f.84981c"}]}],"out":[]},{"id":"7ca5af9a.33634","type":"modbus-flex-write","z":"dfacbc6.89ec44","name":"","showStatusActivities":false,"showErrors":false,"server":"2043f56b.c0f832","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1090,"y":140,"wires":[[],[]]},{"id":"bbd51f72.9a848","type":"split","z":"dfacbc6.89ec44","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"value","x":550,"y":140,"wires":[["69fcab3f.6a0b74"]]},{"id":"6b11aa8f.84981c","type":"change","z":"dfacbc6.89ec44","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"object","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":140,"wires":[["bbd51f72.9a848"]]},{"id":"69fcab3f.6a0b74","type":"delay","z":"dfacbc6.89ec44","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":140,"wires":[["460cb3ee.16e79c"]]},{"id":"460cb3ee.16e79c","type":"function","z":"dfacbc6.89ec44","name":"AM103+L","func":"var UNIT = env.get(\"UNIT\");\n\nlet address = 0;\n\nif(msg.value == \"battery\") {\n    address = 1;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"co2\") address = 2;\n\nif(msg.value == \"humidity\") {\n    address = 3;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"temperature\") {\n    address = 4;\n    msg.payload = msg.payload*10;\n}\n\n\n\nmsg.payload = { \n    'value': msg.payload, \n    'fc': 6, \n    'unitid': UNIT, \n    'address': address,\n    'quantity': 1\n}\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":140,"wires":[["7ca5af9a.33634"]]},{"id":"bc4f10c8.9bff1","type":"modbus-queue-info","z":"dfacbc6.89ec44","name":"","topic":"","unitid":"${UNIT}","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"2043f56b.c0f832","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":1310,"y":140,"wires":[[]]},{"id":"2043f56b.c0f832","type":"modbus-client","name":"JACE","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"192.168.23.10","tcpPort":"5021","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"","commandDelay":"0","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":false},{"id":"c1c47cc4.0bfe78","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"ee16f661.f8692","type":"switch","z":"c1c47cc4.0bfe78","name":"","property":"deveui","propertyType":"msg","rules":[{"t":"eq","v":"24e124725d243990","vt":"str"},{"t":"eq","v":"24e124725d243991","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":60,"wires":[["e78ba814.53b8c8"],[]]},{"id":"a5b00aa5.5c84c8","type":"LoRa Input","z":"c1c47cc4.0bfe78","name":"","devEUI":"","extendedField":"","x":120,"y":60,"wires":[["ee16f661.f8692"]]},{"id":"e78ba814.53b8c8","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"TEST","env":[{"name":"UNIT","value":"1","type":"num"}],"x":770,"y":60,"wires":[]},{"id":"4bcc21e4.c83ab","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":60,"wires":[]}]
