// LORA to Modbus TCP
[{"id":"dfacbc6.89ec44","type":"subflow","name":"Subflow 2","info":"","in":[{"x":200,"y":140,"wires":[{"id":"6b11aa8f.84981c"},{"id":"ea62832f.011ee8"}]}],"out":[]},{"id":"7ca5af9a.33634","type":"modbus-flex-write","z":"dfacbc6.89ec44","name":"","showStatusActivities":false,"showErrors":false,"server":"2043f56b.c0f832","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1090,"y":140,"wires":[[],[]]},{"id":"bbd51f72.9a848","type":"split","z":"dfacbc6.89ec44","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"value","x":550,"y":120,"wires":[["69fcab3f.6a0b74"]]},{"id":"6b11aa8f.84981c","type":"change","z":"dfacbc6.89ec44","name":"","rules":[{"t":"set","p":"object.spreadFactor","pt":"msg","to":"dr.spreadFactor","tot":"msg"},{"t":"set","p":"object.snr","pt":"msg","to":"snr","tot":"msg"},{"t":"set","p":"object.rssi","pt":"msg","to":"rssi","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"object","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":120,"wires":[["bbd51f72.9a848"]]},{"id":"69fcab3f.6a0b74","type":"delay","z":"dfacbc6.89ec44","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":120,"wires":[["460cb3ee.16e79c"]]},{"id":"460cb3ee.16e79c","type":"function","z":"dfacbc6.89ec44","name":"AM103+L","func":"var UNIT = env.get(\"UNIT\");\n\nlet address = 0;\n\nif(msg.value == \"battery\") {\n    address = 1;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"co2\") address = 2;\n\nif(msg.value == \"humidity\") {\n    address = 3;\n    msg.payload = msg.payload*10;\n}\n\nif(msg.value == \"temperature\") {\n    address = 4;\n    msg.payload = msg.payload*10;\n}\nif(msg.value == \"rssi\") {\n    address = 5;\n    msg.payload = msg.payload*-1;\n}\nif(msg.value == \"snr\") {\n    address = 6;\n    msg.payload = (msg.payload + 100)*10;\n}\nif(msg.payload.value == \"fault\") {\n    address = 7;\n    msg.payload = msg.payload.payload;\n}\nif(msg.value == \"spreadFactor\") {\n    address = 8;\n    msg.payload = msg.payload;\n}\n\n\n\nmsg.payload = { \n    'value': msg.payload, \n    'fc': 6, \n    'unitid': UNIT, \n    'address': address,\n    'quantity': 1\n}\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":140,"wires":[["7ca5af9a.33634"]]},{"id":"bc4f10c8.9bff1","type":"modbus-queue-info","z":"dfacbc6.89ec44","name":"","topic":"","unitid":"${UNIT}","queueReadIntervalTime":1000,"lowLowLevel":25,"lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"2043f56b.c0f832","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":false,"updateOnAllUnitQueues":false,"x":1310,"y":140,"wires":[[]]},{"id":"ea62832f.011ee8","type":"trigger","z":"dfacbc6.89ec44","name":"CommFault","op1":"{\"value\":\"fault\",\"payload\":0}","op2":"{\"value\":\"fault\",\"payload\":1}","op1type":"json","op2type":"json","duration":"5","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":200,"wires":[["460cb3ee.16e79c"]]},{"id":"2043f56b.c0f832","type":"modbus-client","name":"JACE","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"192.168.23.10","tcpPort":"5021","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"","commandDelay":"0","clientTimeout":"1000","reconnectOnTimeout":true,"reconnectTimeout":"2000","parallelUnitIdsAllowed":false},{"id":"c1c47cc4.0bfe78","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"ee16f661.f8692","type":"switch","z":"c1c47cc4.0bfe78","name":"","property":"deveui","propertyType":"msg","rules":[{"t":"eq","v":"24e124725d243990","vt":"str"},{"t":"eq","v":"24e124725d243936","vt":"str"},{"t":"eq","v":"24e124725d243031","vt":"str"},{"t":"eq","v":"24e124725d243006","vt":"str"},{"t":"eq","v":"24e124725c461026","vt":"str"},{"t":"eq","v":"24e124725d226265","vt":"str"},{"t":"eq","v":"24e124725d243566","vt":"str"},{"t":"eq","v":"24e124725d223756","vt":"str"},{"t":"eq","v":"24e124725c461045","vt":"str"},{"t":"eq","v":"24e124725d221723","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":470,"y":560,"wires":[["e78ba814.53b8c8"],["2ea8d0ea.81ea1"],["a01d6ab0.7a0b88"],["d0901cf0.69d478"],["a6bbaa70.8fbe98"],["863677f7.25593"],["ac6b78ea.4177b"],["cf3541b1.5ec81"],["d1928f86.457f"],["8f9653b6.2dacf"]]},{"id":"a5b00aa5.5c84c8","type":"LoRa Input","z":"c1c47cc4.0bfe78","name":"","devEUI":"","extendedField":"","x":180,"y":560,"wires":[["ee16f661.f8692"]]},{"id":"e78ba814.53b8c8","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"TEST","env":[{"name":"UNIT","value":"1","type":"num"}],"x":770,"y":60,"wires":[]},{"id":"4bcc21e4.c83ab","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":60,"wires":[]},{"id":"2ea8d0ea.81ea1","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"1","env":[{"name":"UNIT","value":"2","type":"num"}],"x":770,"y":120,"wires":[]},{"id":"51882e96.98421","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":120,"wires":[]},{"id":"a01d6ab0.7a0b88","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"2","env":[{"name":"UNIT","value":"3","type":"num"}],"x":770,"y":180,"wires":[]},{"id":"18ac28fb.d9c4f7","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":180,"wires":[]},{"id":"d0901cf0.69d478","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"3","env":[{"name":"UNIT","value":"4","type":"num"}],"x":770,"y":240,"wires":[]},{"id":"3af5d999.01188e","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":240,"wires":[]},{"id":"863677f7.25593","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"5","env":[{"name":"UNIT","value":"6","type":"num"}],"x":770,"y":360,"wires":[]},{"id":"26bdf23d.822fa6","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":360,"wires":[]},{"id":"ac6b78ea.4177b","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"6","env":[{"name":"UNIT","value":"7","type":"num"}],"x":770,"y":420,"wires":[]},{"id":"a45f913d.c235d","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":420,"wires":[]},{"id":"cf3541b1.5ec81","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"7","env":[{"name":"UNIT","value":"8","type":"num"}],"x":770,"y":480,"wires":[]},{"id":"c83f363b.b29bb","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":480,"wires":[]},{"id":"d1928f86.457f","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"8","env":[{"name":"UNIT","value":"9","type":"num"}],"x":770,"y":540,"wires":[]},{"id":"2641ed35.de37e2","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":540,"wires":[]},{"id":"8f9653b6.2dacf","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"9","env":[{"name":"UNIT","value":"10","type":"num"}],"x":770,"y":600,"wires":[]},{"id":"eb48e71b.21dab","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":600,"wires":[]},{"id":"a6bbaa70.8fbe98","type":"subflow:dfacbc6.89ec44","z":"c1c47cc4.0bfe78","name":"4","env":[{"name":"UNIT","value":"5","type":"num"}],"x":770,"y":300,"wires":[]},{"id":"4b684b1e.b76ef4","type":"comment","z":"c1c47cc4.0bfe78","name":"Milesight AM103+L","info":"","x":950,"y":300,"wires":[]}]
